import{i as F,g as q,a as Y,b as K,c as M,d as j,e as L,r as Q,u as W,f as G,h as g,o as z,j as e,k as J,E as V,l as C,m as I,n as X,p as R,q as H,w as Z,s as ee,t as _,v as se,B as S,x as ae,y as te,Q as re}from"./vendor-DJO9p9Nw.js";const ne={apiKey:"AIzaSyC-i-_e-DdbtpmrFMbIrIFMAKJQGX7jPOI",authDomain:"cheetahchat-e7ae8.firebaseapp.com",projectId:"cheetahchat-e7ae8",storageBucket:"cheetahchat-e7ae8.appspot.com",messagingSenderId:"1065154218546",appId:"1:1065154218546:web:fca3171f55e0a2d7818a2b"};F(ne);const B=q(),x=Y(),ce=K(),U=M(s=>({currentUser:null,isLoading:!0,fetchUserInfo:async t=>{if(!t)return s({currentUser:null,isLoading:!1});try{const n=j(x,"users",t),i=await L(n);i.exists()?s({currentUser:i.data(),isLoading:!1}):s({currentUser:null,isLoading:!1})}catch(n){return console.log(n),s({currentUser:null,isLoading:!1})}}})),A=M(s=>({chatId:null,user:null,isCurrentUserBlocked:!1,isReceiverBlocked:!1,changeChat:(t,n)=>{const i=U.getState().currentUser;return n.blocked.includes(i.id)?s({chatId:t,user:null,isCurrentUserBlocked:!0,isReceiverBlocked:!1}):i.blocked.includes(n.id)?s({chatId:t,user:n,isCurrentUserBlocked:!1,isReceiverBlocked:!0}):s({chatId:t,user:n,isCurrentUserBlocked:!1,isReceiverBlocked:!1})},changeBlock:()=>{s(t=>({...t,isReceiverBlocked:!t.isReceiverBlocked}))},resetChat:()=>{s({chatId:null,user:null,isCurrentUserBlocked:!1,isReceiverBlocked:!1})}})),$=async s=>{const n=Q(ce,`images/${new Date+s.name}`),i=W(n,s);return new Promise((p,u)=>{i.on("state_changed",c=>{const l=c.bytesTransferred/c.totalBytes*100;console.log("Upload is "+l+"% done")},c=>{u("Something went wrong!"+c.code)},()=>{G(i.snapshot.ref).then(c=>{p(c)})})})},le=()=>{var y;const[s,t]=g.useState(),[n,i]=g.useState(!1),[p,u]=g.useState(""),[c,l]=g.useState({file:null,url:""}),{currentUser:d}=U(),{chatId:h,user:o,isCurrentUserBlocked:a,isReceiverBlocked:f}=A(),b=g.useRef(null);g.useEffect(()=>{var r;(r=b.current)==null||r.scrollIntoView({behavior:"smooth"})},[s.messages]),g.useEffect(()=>{const r=z(j(x,"chats",h),w=>{t(w.data())});return()=>{r()}},[h]);const N=r=>{u(w=>w+r.emoji),i(!1)},m=r=>{r.target.files[0]&&l({file:r.target.files[0],url:URL.createObjectURL(r.target.files[0])})},v=async()=>{if(p==="")return;let r=null;try{c.file&&(r=await $(c.file)),await C(j(x,"chats",h),{messages:I({senderId:d.id,text:p,createdAt:new Date,...r&&{img:r}})}),[d.id,o.id].forEach(async O=>{const E=j(x,"userchats",O),P=await L(E);if(P.exists()){const k=P.data(),D=k.chats.findIndex(T=>T.chatId===h);k.chats[D].lastMessage=p,k.chats[D].isSeen=O===d.id,k.chats[D].updatedAt=Date.now(),await C(E,{chats:k.chats})}})}catch(w){console.log(w)}finally{l({file:null,url:""}),u("")}};return e.jsxs("div",{className:"chat",children:[e.jsxs("div",{className:"top",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(o==null?void 0:o.avatar)||"./avatar.png",alt:""}),e.jsxs("div",{className:"texts",children:[e.jsx("span",{children:o==null?void 0:o.username}),e.jsx("p",{children:"Lorem ipsum dolor, sit amet."})]})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"./phone.png",alt:""}),e.jsx("img",{src:"./video.png",alt:""}),e.jsx("img",{src:"./info.png",alt:""})]})]}),e.jsxs("div",{className:"center",children:[(y=s==null?void 0:s.messages)==null?void 0:y.map(r=>e.jsx("div",{className:r.senderId===(d==null?void 0:d.id)?"message own":"message",children:e.jsxs("div",{className:"texts",children:[r.img&&e.jsx("img",{src:r.img,alt:""}),e.jsx("p",{children:r.text}),e.jsx("span",{children:J(r.createdAt.toDate())})]})},r==null?void 0:r.createAt)),c.url&&e.jsx("div",{className:"message own",children:e.jsx("div",{className:"texts",children:e.jsx("img",{src:c.url,alt:""})})}),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"bottom",children:[e.jsxs("div",{className:"icons",children:[e.jsx("label",{htmlFor:"file",children:e.jsx("img",{src:"./img.png",alt:""})}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:m}),e.jsx("img",{src:"./camera.png",alt:""}),e.jsx("img",{src:"./mic.png",alt:""})]}),e.jsx("input",{type:"text",placeholder:a||f?"You've blocked this user. If you want to message them, please unblock them first.":"Type a message...",value:p,onChange:r=>u(r.target.value),disabled:a||f}),e.jsxs("div",{className:"emoji",children:[e.jsx("img",{src:"./emoji.png",alt:"",onClick:()=>i(r=>!r)}),e.jsx("div",{className:"picker",children:e.jsx(V,{open:n,onEmojiClick:N})})]}),e.jsx("button",{className:"sendButton",onClick:v,disabled:a||f,children:"Send"})]})]})},xe=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"})),ie=()=>{const{chatId:s,user:t,isCurrentUserBlocked:n,isReceiverBlocked:i,changeBlock:p,resetChat:u}=A(),{currentUser:c}=U(),l=async()=>{if(!t)return;const h=j(x,"users",c.id);try{await C(h,{blocked:i?X(t.id):I(t.id)}),p()}catch(o){console.log(o)}},d=()=>{B.signOut(),u()};return e.jsxs("div",{className:"detail",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(t==null?void 0:t.avatar)||"./avatar.png",alt:""}),e.jsx("h2",{children:t==null?void 0:t.username}),e.jsx("p",{children:"Lorem ipsum dolor sit amet."})]}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Chat Settings"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Chat Settings"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Privacy & help"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared photos"}),e.jsx("img",{src:"./arrowDown.png",alt:""})]}),e.jsxs("div",{className:"photos",children:[e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]})]})]}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared Files"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("button",{onClick:l,children:n?"You are Blocked!":i?"User blocked":"Block User"}),e.jsx("button",{className:"logout",onClick:d,children:"Logout"})]})]})},je=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),oe=()=>{const[s,t]=g.useState(null),{currentUser:n}=U(),i=async u=>{u.preventDefault();const l=new FormData(u.target).get("username");try{const d=R(x,"users"),h=H(d,Z("username","==",l)),o=await ee(h);o.empty||t(o.docs[0].data())}catch(d){console.log(d)}},p=async()=>{const u=R(x,"chats"),c=R(x,"userchats");try{const l=j(u);await _(l,{createdAt:se(),messages:[]}),await C(j(c,s.id),{chats:I({chatId:l.id,lastMessage:"",receiverId:n.id,updatedAt:Date.now()})}),await C(j(c,n.id),{chats:I({chatId:l.id,lastMessage:"",receiverId:s.id,updatedAt:Date.now()})})}catch(l){console.log(l)}};return e.jsxs("div",{className:"addUser",children:[e.jsxs("form",{onSubmit:i,children:[e.jsx("input",{type:"text",placeholder:"Username",name:"username"}),e.jsx("button",{children:"Search"})]}),s&&e.jsxs("div",{className:"user",children:[e.jsxs("div",{className:"detail",children:[e.jsx("img",{src:s.avatar||"./avatar.png",alt:""}),e.jsx("span",{children:s.username})]}),e.jsx("button",{onClick:p,children:"Add User"})]})]})},de=()=>{const[s,t]=g.useState([]),[n,i]=g.useState(!1),[p,u]=g.useState(""),{currentUser:c}=U(),{chatId:l,changeChat:d}=A();g.useEffect(()=>{const a=z(j(x,"userchats",c.id),async f=>{const N=f.data().chats.map(async v=>{const y=j(x,"users",v.receiverId),w=(await L(y)).data();return{...v,user:w}}),m=await Promise.all(N);t(m.sort((v,y)=>y.updatedAt-v.updatedAt))});return()=>{a()}},[c.id]);const h=async a=>{const f=s.map(m=>{const{user:v,...y}=m;return y}),b=f.findIndex(m=>m.chatId===a.chatId);f[b].isSeen=!0;const N=j(x,"userchats",c.id);try{await C(N,{chats:f}),d(a.chatId,a.user)}catch(m){console.log(m)}},o=s.filter(a=>a.user.username.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"chatList",children:[e.jsxs("div",{className:"search",children:[e.jsxs("div",{className:"searchBar",children:[e.jsx("img",{src:"./search.png",alt:""}),e.jsx("input",{type:"text",placeholder:"Search",onChange:a=>u(a.target.value)})]}),e.jsx("img",{src:n?"./minus.png":"./plus.png",alt:"",className:"add",onClick:()=>i(a=>!a)})]}),o.map(a=>e.jsxs("div",{className:"item",onClick:()=>h(a),style:{backgroundColor:a!=null&&a.isSeen?"transparent":"#5183fe"},children:[e.jsx("img",{src:a.user.blocked.includes(c.id)?"./avatar.png":a.user.avatar||"./avatar.png",alt:""}),e.jsxs("div",{className:"texts",children:[e.jsx("span",{children:a.user.blocked.includes(c.id)?"User":a.user.username}),e.jsx("p",{children:a.lastMessage})]})]},a.chatId)),n&&e.jsx(oe,{})]})},ue=()=>{const{currentUser:s}=U();return e.jsxs("div",{className:"userInfo",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:s.avatar||"./avatar.png",alt:""}),e.jsx("h2",{children:s.username})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"./more.png",alt:""}),e.jsx("img",{src:"./video.png",alt:""}),e.jsx("img",{src:"./edit.png",alt:""})]})]})},he=()=>e.jsxs("div",{className:"list",children:[e.jsx(ue,{}),e.jsx(de,{})]}),fe=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),me=()=>{const[s,t]=g.useState({file:null,url:""}),[n,i]=g.useState(!1),p=l=>{l.target.files[0]&&t({file:l.target.files[0],url:URL.createObjectURL(l.target.files[0])})},u=async l=>{l.preventDefault(),i(!0);const d=new FormData(l.target),{username:h,email:o,password:a}=Object.fromEntries(d);if(!h||!o||!a)return S.warn("Please enter inputs!");if(!s.file)return S.warn("Please upload an avatar!");const f=collection(x,"users"),b=query(f,where("username","==",h));if(!(await getDocs(b)).empty)return S.warn("Select another username");try{const m=await ae(B,o,a),v=await $(s.file);await _(j(x,"users",m.user.uid),{username:h,email:o,avatar:v,id:m.user.uid,blocked:[]}),await _(j(x,"userchats",m.user.uid),{chats:[]}),S.success("Account created! You can login now!")}catch(m){console.log(m),S.error(m.message)}finally{i(!1)}},c=async l=>{l.preventDefault(),i(!0);const d=new FormData(l.target),{email:h,password:o}=Object.fromEntries(d);try{await te(B,h,o)}catch(a){console.log(a),S.error(a.message)}finally{i(!1)}};return e.jsxs("div",{className:"login",children:[e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"CheetChat"}),e.jsxs("form",{onSubmit:c,children:[e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:n,children:n?"Loading":"Sign In"})]})]}),e.jsx("div",{className:"separator"}),e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Create an Account"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("label",{htmlFor:"file",children:[e.jsx("img",{src:s.url||"./avatar.png",alt:""}),"Upload an image"]}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:p}),e.jsx("input",{type:"text",placeholder:"Username",name:"username"}),e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:n,children:n?"Loading":"Sign Up"})]})]})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"})),pe=()=>e.jsx("div",{className:"",children:e.jsx(re,{position:"bottom-right"})}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{xe as C,je as D,fe as L,ye as N,A as a,B as b,ve as c,x as d,U as u};
