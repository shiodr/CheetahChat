import{i as K,g as Q,a as W,b as G,c as M,d as j,e as L,r as J,u as V,f as X,h as g,o as z,j as e,k as H,E as Z,l as C,m as D,n as ee,p as I,q as T,w as F,s as q,t as _,v as se,B as S,x as ae,y as te,Q as re}from"./vendor-DJO9p9Nw.js";const ne={apiKey:"AIzaSyC-i-_e-DdbtpmrFMbIrIFMAKJQGX7jPOI",authDomain:"cheetahchat-e7ae8.firebaseapp.com",projectId:"cheetahchat-e7ae8",storageBucket:"cheetahchat-e7ae8.appspot.com",messagingSenderId:"1065154218546",appId:"1:1065154218546:web:fca3171f55e0a2d7818a2b"};K(ne);const B=Q(),x=W(),ce=G(),U=M(s=>({currentUser:null,isLoading:!0,fetchUserInfo:async t=>{if(!t)return s({currentUser:null,isLoading:!1});try{const c=j(x,"users",t),n=await L(c);n.exists()?s({currentUser:n.data(),isLoading:!1}):s({currentUser:null,isLoading:!1})}catch(c){return console.log(c),s({currentUser:null,isLoading:!1})}}})),A=M(s=>({chatId:null,user:null,isCurrentUserBlocked:!1,isReceiverBlocked:!1,changeChat:(t,c)=>{const n=U.getState().currentUser;return c.blocked.includes(n.id)?s({chatId:t,user:null,isCurrentUserBlocked:!0,isReceiverBlocked:!1}):n.blocked.includes(c.id)?s({chatId:t,user:c,isCurrentUserBlocked:!1,isReceiverBlocked:!0}):s({chatId:t,user:c,isCurrentUserBlocked:!1,isReceiverBlocked:!1})},changeBlock:()=>{s(t=>({...t,isReceiverBlocked:!t.isReceiverBlocked}))},resetChat:()=>{s({chatId:null,user:null,isCurrentUserBlocked:!1,isReceiverBlocked:!1})}})),$=async s=>{const c=J(ce,`images/${new Date+s.name}`),n=V(c,s);return new Promise((m,u)=>{n.on("state_changed",l=>{const i=l.bytesTransferred/l.totalBytes*100;console.log("Upload is "+i+"% done")},l=>{u("Something went wrong!"+l.code)},()=>{X(n.snapshot.ref).then(l=>{m(l)})})})},le=()=>{var w;const[s,t]=g.useState(),[c,n]=g.useState(!1),[m,u]=g.useState(""),[l,i]=g.useState({file:null,url:""}),{currentUser:d}=U(),{chatId:h,user:o,isCurrentUserBlocked:a,isReceiverBlocked:f}=A(),N=g.useRef(null);g.useEffect(()=>{var r;(r=N.current)==null||r.scrollIntoView({behavior:"smooth"})},[s.messages]),g.useEffect(()=>{const r=z(j(x,"chats",h),b=>{t(b.data())});return()=>{r()}},[h]);const v=r=>{u(b=>b+r.emoji),n(!1)},p=r=>{r.target.files[0]&&i({file:r.target.files[0],url:URL.createObjectURL(r.target.files[0])})},y=async()=>{if(m==="")return;let r=null;try{l.file&&(r=await $(l.file)),await C(j(x,"chats",h),{messages:D({senderId:d.id,text:m,createdAt:new Date,...r&&{img:r}})}),[d.id,o.id].forEach(async E=>{const O=j(x,"userchats",E),P=await L(O);if(P.exists()){const k=P.data(),R=k.chats.findIndex(Y=>Y.chatId===h);k.chats[R].lastMessage=m,k.chats[R].isSeen=E===d.id,k.chats[R].updatedAt=Date.now(),await C(O,{chats:k.chats})}})}catch(b){console.log(b)}finally{i({file:null,url:""}),u("")}};return e.jsxs("div",{className:"chat",children:[e.jsxs("div",{className:"top",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(o==null?void 0:o.avatar)||"./avatar.png",alt:""}),e.jsxs("div",{className:"texts",children:[e.jsx("span",{children:o==null?void 0:o.username}),e.jsx("p",{children:"Lorem ipsum dolor, sit amet."})]})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"./phone.png",alt:""}),e.jsx("img",{src:"./video.png",alt:""}),e.jsx("img",{src:"./info.png",alt:""})]})]}),e.jsxs("div",{className:"center",children:[(w=s==null?void 0:s.messages)==null?void 0:w.map(r=>e.jsx("div",{className:r.senderId===(d==null?void 0:d.id)?"message own":"message",children:e.jsxs("div",{className:"texts",children:[r.img&&e.jsx("img",{src:r.img,alt:""}),e.jsx("p",{children:r.text}),e.jsx("span",{children:H(r.createdAt.toDate())})]})},r==null?void 0:r.createAt)),l.url&&e.jsx("div",{className:"message own",children:e.jsx("div",{className:"texts",children:e.jsx("img",{src:l.url,alt:""})})}),e.jsx("div",{ref:N})]}),e.jsxs("div",{className:"bottom",children:[e.jsxs("div",{className:"icons",children:[e.jsx("label",{htmlFor:"file",children:e.jsx("img",{src:"./img.png",alt:""})}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:p}),e.jsx("img",{src:"./camera.png",alt:""}),e.jsx("img",{src:"./mic.png",alt:""})]}),e.jsx("input",{type:"text",placeholder:a||f?"You've blocked this user. If you want to message them, please unblock them first.":"Type a message...",value:m,onChange:r=>u(r.target.value),disabled:a||f}),e.jsxs("div",{className:"emoji",children:[e.jsx("img",{src:"./emoji.png",alt:"",onClick:()=>n(r=>!r)}),e.jsx("div",{className:"picker",children:e.jsx(Z,{open:c,onEmojiClick:v})})]}),e.jsx("button",{className:"sendButton",onClick:y,disabled:a||f,children:"Send"})]})]})},xe=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"})),ie=()=>{const{chatId:s,user:t,isCurrentUserBlocked:c,isReceiverBlocked:n,changeBlock:m,resetChat:u}=A(),{currentUser:l}=U(),i=async()=>{if(!t)return;const h=j(x,"users",l.id);try{await C(h,{blocked:n?ee(t.id):D(t.id)}),m()}catch(o){console.log(o)}},d=()=>{B.signOut(),u()};return e.jsxs("div",{className:"detail",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:(t==null?void 0:t.avatar)||"./avatar.png",alt:""}),e.jsx("h2",{children:t==null?void 0:t.username}),e.jsx("p",{children:"Lorem ipsum dolor sit amet."})]}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Chat Settings"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Chat Settings"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Privacy & help"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsxs("div",{className:"option",children:[e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared photos"}),e.jsx("img",{src:"./arrowDown.png",alt:""})]}),e.jsxs("div",{className:"photos",children:[e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]}),e.jsxs("div",{className:"photoItem",children:[e.jsxs("div",{className:"photoDetail",children:[e.jsx("img",{src:"https://images.pexels.com/photos/7381200/pexels-photo-7381200.jpeg?auto=compress&cs=tinysrgb&w=800&lazy=load",alt:""}),e.jsx("span",{children:"photo_2024_2.png"})]}),e.jsx("img",{src:"./download.png",alt:"",className:"icon"})]})]})]}),e.jsx("div",{className:"option",children:e.jsxs("div",{className:"title",children:[e.jsx("span",{children:"Shared Files"}),e.jsx("img",{src:"./arrowUp.png",alt:""})]})}),e.jsx("button",{onClick:i,children:c?"You are Blocked!":n?"User blocked":"Block User"}),e.jsx("button",{className:"logout",onClick:d,children:"Logout"})]})]})},je=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),oe=()=>{const[s,t]=g.useState(null),{currentUser:c}=U(),n=async u=>{u.preventDefault();const i=new FormData(u.target).get("username");try{const d=I(x,"users"),h=T(d,F("username","==",i)),o=await q(h);o.empty||t(o.docs[0].data())}catch(d){console.log(d)}},m=async()=>{const u=I(x,"chats"),l=I(x,"userchats");try{const i=j(u);await _(i,{createdAt:se(),messages:[]}),await C(j(l,s.id),{chats:D({chatId:i.id,lastMessage:"",receiverId:c.id,updatedAt:Date.now()})}),await C(j(l,c.id),{chats:D({chatId:i.id,lastMessage:"",receiverId:s.id,updatedAt:Date.now()})})}catch(i){console.log(i)}};return e.jsxs("div",{className:"addUser",children:[e.jsxs("form",{onSubmit:n,children:[e.jsx("input",{type:"text",placeholder:"Username",name:"username"}),e.jsx("button",{children:"Search"})]}),s&&e.jsxs("div",{className:"user",children:[e.jsxs("div",{className:"detail",children:[e.jsx("img",{src:s.avatar||"./avatar.png",alt:""}),e.jsx("span",{children:s.username})]}),e.jsx("button",{onClick:m,children:"Add User"})]})]})},de=()=>{const[s,t]=g.useState([]),[c,n]=g.useState(!1),[m,u]=g.useState(""),{currentUser:l}=U(),{chatId:i,changeChat:d}=A();g.useEffect(()=>{const a=z(j(x,"userchats",l.id),async f=>{const v=f.data().chats.map(async y=>{const w=j(x,"users",y.receiverId),b=(await L(w)).data();return{...y,user:b}}),p=await Promise.all(v);t(p.sort((y,w)=>w.updatedAt-y.updatedAt))});return()=>{a()}},[l.id]);const h=async a=>{const f=s.map(p=>{const{user:y,...w}=p;return w}),N=f.findIndex(p=>p.chatId===a.chatId);f[N].isSeen=!0;const v=j(x,"userchats",l.id);try{await C(v,{chats:f}),d(a.chatId,a.user)}catch(p){console.log(p)}},o=s.filter(a=>a.user.username.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"chatList",children:[e.jsxs("div",{className:"search",children:[e.jsxs("div",{className:"searchBar",children:[e.jsx("img",{src:"./search.png",alt:""}),e.jsx("input",{type:"text",placeholder:"Search",onChange:a=>u(a.target.value)})]}),e.jsx("img",{src:c?"./minus.png":"./plus.png",alt:"",className:"add",onClick:()=>n(a=>!a)})]}),o.map(a=>e.jsxs("div",{className:"item",onClick:()=>h(a),style:{backgroundColor:a!=null&&a.isSeen?"transparent":"#5183fe"},children:[e.jsx("img",{src:a.user.blocked.includes(l.id)?"./avatar.png":a.user.avatar||"./avatar.png",alt:""}),e.jsxs("div",{className:"texts",children:[e.jsx("span",{children:a.user.blocked.includes(l.id)?"User":a.user.username}),e.jsx("p",{children:a.lastMessage})]})]},a.chatId)),c&&e.jsx(oe,{})]})},ue=()=>{const{currentUser:s}=U();return e.jsxs("div",{className:"userInfo",children:[e.jsxs("div",{className:"user",children:[e.jsx("img",{src:s.avatar||"./avatar.png",alt:""}),e.jsx("h2",{children:s.username})]}),e.jsxs("div",{className:"icons",children:[e.jsx("img",{src:"./more.png",alt:""}),e.jsx("img",{src:"./video.png",alt:""}),e.jsx("img",{src:"./edit.png",alt:""})]})]})},he=()=>e.jsxs("div",{className:"list",children:[e.jsx(ue,{}),e.jsx(de,{})]}),fe=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),me=()=>{const[s,t]=g.useState({file:null,url:""}),[c,n]=g.useState(!1),m=i=>{i.target.files[0]&&t({file:i.target.files[0],url:URL.createObjectURL(i.target.files[0])})},u=async i=>{i.preventDefault(),n(!0);const d=new FormData(i.target),{username:h,email:o,password:a}=Object.fromEntries(d);if(!h||!o||!a){S.warn("Please enter all inputs!"),n(!1);return}if(!s.file){S.warn("Please upload an avatar!"),n(!1);return}const f=I(x,"users"),N=T(f,F("username","==",h));try{if(!(await q(N)).empty){S.warn("Select another username"),n(!1);return}const p=await ae(B,o,a);console.log("User created:",p.user);const y=await $(s.file);await _(j(x,"users",p.user.uid),{username:h,email:o,avatar:y,id:p.user.uid,blocked:[]}),await _(j(x,"userchats",p.user.uid),{chats:[]}),S.success("Account created! You can login now!")}catch(v){console.log("Error during registration:",v),S.error(v.message)}finally{n(!1)}},l=async i=>{i.preventDefault(),n(!0);const d=new FormData(i.target),{email:h,password:o}=Object.fromEntries(d);try{await te(B,h,o)}catch(a){console.log("Error during login:",a),S.error(a.message)}finally{n(!1)}};return e.jsxs("div",{className:"login",children:[e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"CheetChat"}),e.jsxs("form",{onSubmit:l,children:[e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:c,children:c?"Loading":"Sign In"})]})]}),e.jsx("div",{className:"separator"}),e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Create an Account"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("label",{htmlFor:"file",children:[e.jsx("img",{src:s.url||"./avatar.png",alt:"Avatar"}),"Upload an image"]}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:m}),e.jsx("input",{type:"text",placeholder:"Username",name:"username"}),e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:c,children:c?"Loading":"Sign Up"})]})]})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"})),pe=()=>e.jsx("div",{className:"",children:e.jsx(re,{position:"bottom-right"})}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{xe as C,je as D,fe as L,ye as N,A as a,B as b,ve as c,x as d,U as u};
